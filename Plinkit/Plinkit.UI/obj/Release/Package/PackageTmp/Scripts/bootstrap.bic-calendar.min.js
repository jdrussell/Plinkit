$.fn.bic_calendar = function (e) { var t = $.extend({}, $.fn.bic_calendar.defaults, e); this.each(function () { function p() { n = $('<table class="diasmes table table">'); v(); var t = new Date; var s = h.val(); if (s != "") { if (E(s)) { var o = s.split("/"); if (o[2].length == 2) { if (o[2].charAt(0) == "0") { o[2] = o[2].substring(1) } o[2] = parseInt(o[2]); if (o[2] < 50) o[2] += 2e3 } t = new Date(o[2], o[1] - 1, o[0]) } } var u = t.getMonth(); var a = t.getFullYear(); m(u, a); var f = $('<td><a href="#" class="botonmessiguiente"><i class="icon-arrow-right" ></i></a></td>'); f.click(function (e) { e.preventDefault(); u = (u + 1) % 12; if (u == 0) a++; d(u, a) }); var l = $('<td><a href="#" class="botonmesanterior"><i class="icon-arrow-left" ></i></a></td>'); l.click(function (e) { e.preventDefault(); u = u - 1; if (u == -1) { a--; u = 11 } d(u, a) }); var c = $('<table class="table header"></table>'); var p = $('<td colspan=5 class="mesyano span6"></td>'); p.append(r); var g = $("<tr>").append(l).append(p).append(f).append("</tr>"); c.append(g); e = $('<div class="bic_calendar" id="' + i + '" ></div>'); e.prepend(c); e.append(n); h.append(e); S(u, a) } function d(e, t) { n.empty(); v(); m(e, t); S(e, t) } function v() { if (a != false) { var e = $('<tr class="dias_semana" >'); var t = ""; $(o).each(function (e, n) { t += "<td"; if (e == 0) { t += ' class="primero"' } if (e == 6) { t += ' class="domingo ultimo"' } t += ">" + n + "</td>" }); e.append(t).append("</tr>"); n.append(e) } } function m(e, t) { r.text(u[e] + " " + t); var s = 1; var o = y(1, e, t); var a = w(e, t); var f = e + 1; var l = ""; var c = ""; for (var h = 0; h < 7; h++) { c = g(s, f, t); if (h < o) { var p = ""; if (h == 0) p += "<tr>"; p += '<td class="diainvalido' + c; if (h == 0) p += " primero"; p += '"></td>' } else { var p = ""; if (h == 0) p += "<tr>"; p += '<td id="' + i + "_" + s + "_" + f + "_" + t + '" '; if (h == 0) p += ' class="primero' + c + '"'; else if (h == 6) p += ' class="ultimo domingo' + c + '"'; else p += ' class="' + c + '"'; p += "><a href='/Links/" + s + "-" + f + "-" + t + "/web-development'>" + s + "</a></span>"; if (h == 6) p += "</tr>"; s++ } l += p } var d = 1; while (s <= a) { c = g(s, f, t); var p = ""; if (d % 7 == 1) p += "<tr>"; p += '<td id="' + i + "_" + s + "_" + f + "_" + t + '" '; if (d % 7 == 1) p += ' class="primero' + c + '"'; else if (d % 7 == 0) p += ' class="domingo ultimo' + c + '"'; else p += ' class="' + c + '"'; p += "><a href='/Links/" + s + "-" + f + "-" + t + "/web-development'>" + s + "</a></span>"; if (d % 7 == 0) p += "</tr>"; s++; d++; l += p } d--; if (d % 7 != 0) { p = ""; for (var h = d % 7 + 1; h <= 7; h++) { var p = ""; p += '<td class="diainvalido'; if (h == 7) p += " ultimo"; p += '"></td>'; if (h == 7) p += "</tr>"; l += p } } n.append(l) } function g(e, t, n) { var r = new Date; var i = r.getUTCDate(); var s = r.getUTCMonth() + 1; var o = r.getUTCFullYear(); if (e == i && t == s && n == o) return " today"; else return "" } function y(e, t, n) { var r = new Date(n, t, e); var i = r.getDay(); if (i == 0) i = 6; else i--; return i } function b(e, t, n) { return e > 0 && e < 13 && n > 0 && n < 32768 && t > 0 && t <= (new Date(n, e, 0)).getDate() } function w(e, t) { var n = 28; while (b(e + 1, n + 1, t)) { n++ } return n } function E(e) { var t = e.split("/"); if (t.length != 3) return false; return b(t[1], t[0], t[2]) } function S(e, t) { if (c != false) { $.ajax({ type: c.type, url: c.url, data: { mes: e + 1, ano: t }, dataType: "json" }).done(function (n) { s = []; $.each(n, function (e, t) { s.push(n[e]) }); x(e, t) }) } else { x(e, t) } } function x(e, t) { var n = e + 1; for (var r = 0; r < s.length; r++) { if (s[r][0].split("/")[1] == n && s[r][0].split("/")[2] == t) { $("#" + i + "_" + s[r][0].replace(/\//g, "_")).addClass("event"); $("#" + i + "_" + s[r][0].replace(/\//g, "_") + " a").attr("data-original-title", s[r][1]); if (s[r][3]) $("#" + i + "_" + s[r][0].replace(/\//g, "_")).css("background", s[r][3]); if (s[r][2] == "" || s[r][2] == "#") { if (s[r][4] != "") { $("#" + i + "_" + s[r][0].replace(/\//g, "_") + " a").attr("data-trigger", "manual"); $("#" + i + "_" + s[r][0].replace(/\//g, "_") + " a").addClass("manual_popover") } else { $("#" + i + "_" + s[r][0].replace(/\//g, "_") + " a").attr("href", "javascript:false;") } } else { $("#" + i + "_" + s[r][0].replace(/\//g, "_") + " a").attr("href", s[r][2]) } if (s[r][4]) { $("#" + i + "_" + s[r][0].replace(/\//g, "_")).addClass("event_popover"); $("#" + i + "_" + s[r][0].replace(/\//g, "_") + " a").attr("rel", "popover"); $("#" + i + "_" + s[r][0].replace(/\//g, "_") + " a").attr("data-content", s[r][4]) } else { $("#" + i + "_" + s[r][0].replace(/\//g, "_")).addClass("event_tooltip"); $("#" + i + "_" + s[r][0].replace(/\//g, "_") + " a").attr("rel", "tooltip") } } } $("#" + i + " " + ".event_tooltip a").tooltip(l); $("#" + i + " " + ".event_popover a").popover(f); $(".manual_popover").click(function () { $(this).popover("toggle") }) } var e; var n; var r = $('<div class="visualmesano"></div>'); var i = "bic_cal_" + Math.floor(Math.random() * 99999).toString(36); var s = t.events; var o; if (typeof t.dias != "undefined") o = t.dias; else o = ["l", "m", "x", "j", "v", "s", "d"]; var u; if (typeof t.nombresMes != "undefined") u = t.nombresMes; else u = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]; var a; if (typeof t.show_days != "undefined") a = t.show_days; else a = true; var f; if (typeof t.popover_options != "undefined") f = t.popover_options; else f = { placement: "top" }; var l; if (typeof t.tooltip_options != "undefined") l = t.tooltip_options; else l = { placement: "top" }; var c; if (typeof t.req_ajax != "undefined") c = t.req_ajax; else c = false; var h = $(this); p() }); return this }